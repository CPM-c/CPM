# Makefile for  «ŽZµþ
# Generated by CPM init

CC = gcc
CFLAGS = -Wall -Wextra -std=c11 -Iinclude
CFLAGS_DEBUG = -g -O0 -DDEBUG
CFLAGS_RELEASE = -O2 -DNDEBUG

SRCDIR = src
INCDIR = include
BUILDDIR = build
LIBDIR = lib

SOURCES = $(wildcard $(SRCDIR)/*.c)
OBJECTS = $(SOURCES:$(SRCDIR)/%.c=$(BUILDDIR)/%.o)
LIBRARY = $(LIBDIR)/lib «ŽZµþ.a

.PHONY: all clean debug release test

all: $(LIBRARY)

debug: CFLAGS += $(CFLAGS_DEBUG)
debug: $(LIBRARY)

release: CFLAGS += $(CFLAGS_RELEASE)
release: $(LIBRARY)

$(LIBRARY): $(OBJECTS) | $(LIBDIR)
	ar rcs $@ $^

$(BUILDDIR)/%.o: $(SRCDIR)/%.c | $(BUILDDIR)
	$(CC) $(CFLAGS) -c $< -o $@

$(BUILDDIR):
	mkdir -p $(BUILDDIR)

$(LIBDIR):
	mkdir -p $(LIBDIR)

test: $(LIBRARY)
	@echo "Running tests..."
	# Add test commands here

clean:
	rm -rf $(BUILDDIR) $(LIBDIR)

install: $(LIBRARY)
	cp $(LIBRARY) /usr/local/lib/
	cp -r $(INCDIR)/* /usr/local/include/
